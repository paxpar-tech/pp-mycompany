import{m as D,aw as E,V as _,l as z}from"./entry.e5ec0771.js";import{u as q}from"./fetch.dc39b732.js";import{u as U}from"./url.6edfad5e.js";import{u as G}from"./useToast.fbf34f37.js";function f(){return D("backend",()=>{const e=U(),c=z().public.backendForced,r=e.hostname;var s,t;return c!==void 0&&c!==""?(console.log("backendForced",c),s=c,t="forcing via runtine config !!!!"):r==="localhost"?(s="http://localhost:8881",t="hostname is localhost"):d(r,"dev")?(s="https://dev.paxpar.tech",t="hostname contains `.dev.`"):d(r,"uat")?(s="https://uat.paxpar.tech",t="hostname contains `.uat.`"):(s="https://paxpar.tech",t="no other env detected"),console.log(`🐣 useBackend ${s} because ${t}`),s}).value}const N={toast:{pending:{enable:!0,delay:500,duration:3e3},success:{enable:!0,duration:3e3},error:{enable:!0,duration:3e3}}},I=async(a,e)=>{var g,m,h,b,i,k,$,v,P,C,F,w,y,o,x,B,L,T,A,R;const n=await f(),c=await O(),r=G();e=E(N,e,{headers:{...e==null?void 0:e.headers,Authorization:`Bearer ${c}`}});var s=!0,t;(m=(g=e==null?void 0:e.toast)==null?void 0:g.pending)!=null&&m.enable&&setTimeout(()=>{var u,S;s===!0&&(t=r.loading(((S=(u=e==null?void 0:e.toast)==null?void 0:u.pending)==null?void 0:S.msg)||`${a}`))},e.toast.pending.delay);const l=await q(`${n}${a}`,e,"$0fIGPU0xdF");if(s=!1,l.error.value){const u=((b=(h=e==null?void 0:e.toast)==null?void 0:h.error)==null?void 0:b.msg)||`Error (${l.error.value.statusCode}) : ${l.error.value.message}`;(k=(i=e==null?void 0:e.toast)==null?void 0:i.pending)!=null&&k.enable&&t?r.update(t,{render:u,autoClose:($=e==null?void 0:e.toast.error)==null?void 0:$.duration,closeOnClick:!0,closeButton:!0,type:"error",isLoading:!1}):((P=(v=e==null?void 0:e.toast)==null?void 0:v.error)!=null&&P.enable||(F=(C=e==null?void 0:e.toast)==null?void 0:C.pending)!=null&&F.enable)&&r.error(u)}else{const u=((y=(w=e==null?void 0:e.toast)==null?void 0:w.success)==null?void 0:y.msg)||`${a}`;(x=(o=e==null?void 0:e.toast)==null?void 0:o.pending)!=null&&x.enable&&t?r.update(t,{render:u,autoClose:(B=e.toast.success)==null?void 0:B.duration,closeOnClick:!0,closeButton:!0,type:"success",isLoading:!1}):((T=(L=e==null?void 0:e.toast)==null?void 0:L.success)!=null&&T.enable||(R=(A=e==null?void 0:e.toast)==null?void 0:A.pending)!=null&&R.enable)&&r.success(u)}return l};function V(a,e){const c=`${f()}${a}`,r=new URL(c);return r.searchParams.set("Authorization",`Bearer ${e}`),r.toString()}function d(a,e){return a.includes(`.${e}.`)||a.startsWith(`${e}.`)}function W(){return U().hostname}async function O(){var c;const a=await _(),{data:e,error:n}=await a.auth.getSession();return(c=e==null?void 0:e.session)==null?void 0:c.access_token}async function j(){const{data:a}=await I("/api/conf/front/public");return a}const Q=()=>({addAuthURL:V,backend:f(),confFrontPublic:j,domain:W(),isDomainEnv:d,useFetchPP:I,getToken:O});export{Q as u};

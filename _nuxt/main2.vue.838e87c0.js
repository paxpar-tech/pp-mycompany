import ls from"./links.87f67e92.js";import{_ as ds}from"./debug-panel.vue.38490ee1.js";import{u as us}from"./useToast.a3c7f6e5.js";import{u as cs}from"./usePaxparAPI.a3ea0f12.js";import{ao as ze,ap as Ce,d as ps,a0 as hs,r as ft,K as fs,o as ms,aq as gs,b as Ne,c as Me,e as U,I as he,an as vs,f as He,W as ys,ar as ws,g as mt,w as bs,t as gt}from"./entry.444e0c01.js";function xt(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function vt(r,e){if(!Object.prototype.hasOwnProperty.call(r,e))throw new TypeError("attempted to use private field on non-instance");return r}var Ss=0;function Fs(r){return"__private_"+Ss+++"_"+r}function Ps(r,e,t){const s=[];return r.forEach(i=>typeof i!="string"?s.push(i):e[Symbol.split](i).forEach((o,a,n)=>{o!==""&&s.push(o),a<n.length-1&&s.push(t)})),s}/**
 * Takes a string with placeholder variables like `%{smart_count} file selected`
 * and replaces it with values from options `{smart_count: 5}`
 *
 * @license https://github.com/airbnb/polyglot.js/blob/master/LICENSE
 * taken from https://github.com/airbnb/polyglot.js/blob/master/lib/polyglot.js#L299
 *
 * @param {string} phrase that needs interpolation, with placeholders
 * @param {object} options with values that will be used to replace placeholders
 * @returns {any[]} interpolated
 */function yt(r,e){const t=/\$/g,s="$$$$";let i=[r];if(e==null)return i;for(const o of Object.keys(e))if(o!=="_"){let a=e[o];typeof a=="string"&&(a=t[Symbol.replace](a,s)),i=Ps(i,new RegExp(`%\\{${o}\\}`,"g"),a)}return i}var ve=Fs("apply");class jt{constructor(e){Object.defineProperty(this,ve,{value:Es}),this.locale={strings:{},pluralize(t){return t===1?0:1}},Array.isArray(e)?e.forEach(vt(this,ve)[ve],this):vt(this,ve)[ve](e)}translate(e,t){return this.translateArray(e,t).join("")}translateArray(e,t){if(!xt(this.locale.strings,e))throw new Error(`missing string: ${e}`);const s=this.locale.strings[e];if(typeof s=="object"){if(t&&typeof t.smart_count<"u"){const o=this.locale.pluralize(t.smart_count);return yt(s[o],t)}throw new Error("Attempted to use a string with plural forms, but no value was given for %{smart_count}")}return yt(s,t)}}function Es(r){if(!(r!=null&&r.strings))return;const e=this.locale;this.locale={...e,strings:{...e.strings,...r.strings}},this.locale.pluralize=r.pluralize||e.pluralize}var Ts=function(){var e={},t=e._fns={};e.emit=function(a,n,l,d,u,c,h){var m=s(a);m.length&&i(a,m,[n,l,d,u,c,h])},e.on=function(a,n){t[a]||(t[a]=[]),t[a].push(n)},e.once=function(a,n){function l(){n.apply(this,arguments),e.off(a,l)}this.on(a,l)},e.off=function(a,n){var l=[];if(a&&n){var d=this._fns[a],u=0,c=d?d.length:0;for(u;u<c;u++)d[u]!==n&&l.push(d[u])}l.length?this._fns[a]=l:delete this._fns[a]};function s(o){var a=t[o]?t[o]:[],n=o.indexOf(":"),l=n===-1?[o]:[o.substring(0,n),o.substring(n+1)],d=Object.keys(t),u=0,c=d.length;for(u;u<c;u++){var h=d[u];if(h==="*"&&(a=a.concat(t[h])),l.length===2&&l[0]===h){a=a.concat(t[h]);break}}return a}function i(o,a,n){var l=0,d=a.length;for(l;l<d&&a[l];l++)a[l].event=o,a[l].apply(a[l],n)}return e};const Rt=ze(Ts);let Os="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",kt=(r=21)=>{let e="",t=r;for(;t--;)e+=Os[Math.random()*64|0];return e};function $s(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var ut=$s,_s=typeof Ce=="object"&&Ce&&Ce.Object===Object&&Ce,Us=_s,As=Us,xs=typeof self=="object"&&self&&self.Object===Object&&self,js=As||xs||Function("return this")(),Lt=js,Rs=Lt,ks=function(){return Rs.Date.now()},Ls=ks,Cs=/\s/;function Ns(r){for(var e=r.length;e--&&Cs.test(r.charAt(e)););return e}var Ms=Ns,qs=Ms,Is=/^\s+/;function zs(r){return r&&r.slice(0,qs(r)+1).replace(Is,"")}var Bs=zs,Hs=Lt,Ds=Hs.Symbol,Ct=Ds,wt=Ct,Nt=Object.prototype,Ws=Nt.hasOwnProperty,Ks=Nt.toString,ye=wt?wt.toStringTag:void 0;function Gs(r){var e=Ws.call(r,ye),t=r[ye];try{r[ye]=void 0;var s=!0}catch{}var i=Ks.call(r);return s&&(e?r[ye]=t:delete r[ye]),i}var Xs=Gs,Vs=Object.prototype,Js=Vs.toString;function Ys(r){return Js.call(r)}var Qs=Ys,bt=Ct,Zs=Xs,er=Qs,tr="[object Null]",sr="[object Undefined]",St=bt?bt.toStringTag:void 0;function rr(r){return r==null?r===void 0?sr:tr:St&&St in Object(r)?Zs(r):er(r)}var ir=rr;function or(r){return r!=null&&typeof r=="object"}var nr=or,ar=ir,lr=nr,dr="[object Symbol]";function ur(r){return typeof r=="symbol"||lr(r)&&ar(r)==dr}var cr=ur,pr=Bs,Ft=ut,hr=cr,Pt=0/0,fr=/^[-+]0x[0-9a-f]+$/i,mr=/^0b[01]+$/i,gr=/^0o[0-7]+$/i,vr=parseInt;function yr(r){if(typeof r=="number")return r;if(hr(r))return Pt;if(Ft(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=Ft(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=pr(r);var t=mr.test(r);return t||gr.test(r)?vr(r.slice(2),t?2:8):fr.test(r)?Pt:+r}var wr=yr,br=ut,De=Ls,Et=wr,Sr="Expected a function",Fr=Math.max,Pr=Math.min;function Er(r,e,t){var s,i,o,a,n,l,d=0,u=!1,c=!1,h=!0;if(typeof r!="function")throw new TypeError(Sr);e=Et(e)||0,br(t)&&(u=!!t.leading,c="maxWait"in t,o=c?Fr(Et(t.maxWait)||0,e):o,h="trailing"in t?!!t.trailing:h);function m(w){var I=s,g=i;return s=i=void 0,d=w,a=r.apply(g,I),a}function v(w){return d=w,n=setTimeout(P,e),u?m(w):a}function z(w){var I=w-l,g=w-d,b=e-I;return c?Pr(b,o-g):b}function Z(w){var I=w-l,g=w-d;return l===void 0||I>=e||I<0||c&&g>=o}function P(){var w=De();if(Z(w))return ke(w);n=setTimeout(P,z(w))}function ke(w){return n=void 0,h&&s?m(w):(s=i=void 0,a)}function ee(){n!==void 0&&clearTimeout(n),d=0,s=l=i=n=void 0}function Le(){return n===void 0?a:ke(De())}function me(){var w=De(),I=Z(w);if(s=arguments,i=this,l=w,I){if(n===void 0)return v(l);if(c)return clearTimeout(n),n=setTimeout(P,e),m(l)}return n===void 0&&(n=setTimeout(P,e)),a}return me.cancel=ee,me.flush=Le,me}var Tr=Er,Or=Tr,$r=ut,_r="Expected a function";function Ur(r,e,t){var s=!0,i=!0;if(typeof r!="function")throw new TypeError(_r);return $r(t)&&(s="leading"in t?!!t.leading:s,i="trailing"in t?!!t.trailing:i),Or(r,e,{leading:s,maxWait:e,trailing:i})}var Ar=Ur;const Mt=ze(Ar);function qe(r,e){if(!Object.prototype.hasOwnProperty.call(r,e))throw new TypeError("attempted to use private field on non-instance");return r}var xr=0;function qt(r){return"__private_"+xr+++"_"+r}const jr={version:"3.0.4"};var de=qt("callbacks"),We=qt("publish");class It{constructor(){Object.defineProperty(this,We,{value:Rr}),Object.defineProperty(this,de,{writable:!0,value:new Set}),this.state={}}getState(){return this.state}setState(e){const t={...this.state},s={...this.state,...e};this.state=s,qe(this,We)[We](t,s,e)}subscribe(e){return qe(this,de)[de].add(e),()=>{qe(this,de)[de].delete(e)}}}function Rr(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];qe(this,de)[de].forEach(s=>{s(...e)})}It.VERSION=jr.version;function zt(r){const e=r.lastIndexOf(".");return e===-1||e===r.length-1?{name:r,extension:void 0}:{name:r.slice(0,e),extension:r.slice(e+1)}}const Tt={md:"text/markdown",markdown:"text/markdown",mp4:"video/mp4",mp3:"audio/mp3",svg:"image/svg+xml",jpg:"image/jpeg",png:"image/png",webp:"image/webp",gif:"image/gif",heic:"image/heic",heif:"image/heif",yaml:"text/yaml",yml:"text/yaml",csv:"text/csv",tsv:"text/tab-separated-values",tab:"text/tab-separated-values",avi:"video/x-msvideo",mks:"video/x-matroska",mkv:"video/x-matroska",mov:"video/quicktime",dicom:"application/dicom",doc:"application/msword",docm:"application/vnd.ms-word.document.macroenabled.12",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotm:"application/vnd.ms-word.template.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",xla:"application/vnd.ms-excel",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlc:"application/vnd.ms-excel",xlf:"application/x-xliff+xml",xlm:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlt:"application/vnd.ms-excel",xltm:"application/vnd.ms-excel.template.macroenabled.12",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlw:"application/vnd.ms-excel",txt:"text/plain",text:"text/plain",conf:"text/plain",log:"text/plain",pdf:"application/pdf",zip:"application/zip","7z":"application/x-7z-compressed",rar:"application/x-rar-compressed",tar:"application/x-tar",gz:"application/gzip",dmg:"application/x-apple-diskimage"};function Bt(r){var e;if(r.type)return r.type;const t=r.name?(e=zt(r.name).extension)==null?void 0:e.toLowerCase():null;return t&&t in Tt?Tt[t]:"application/octet-stream"}function kr(r){return r.charCodeAt(0).toString(32)}function Ot(r){let e="";return r.replace(/[^A-Z0-9]/ig,t=>(e+=`-${kr(t)}`,"/"))+e}function Lr(r){let e="uppy";return typeof r.name=="string"&&(e+=`-${Ot(r.name.toLowerCase())}`),r.type!==void 0&&(e+=`-${r.type}`),r.meta&&typeof r.meta.relativePath=="string"&&(e+=`-${Ot(r.meta.relativePath.toLowerCase())}`),r.data.size!==void 0&&(e+=`-${r.data.size}`),r.data.lastModified!==void 0&&(e+=`-${r.data.lastModified}`),e}function Cr(r){return!r.isRemote||!r.remote?!1:new Set(["box","dropbox","drive","facebook","unsplash"]).has(r.remote.provider)}function Nr(r){if(Cr(r))return r.id;const e=Bt(r);return Lr({...r,type:e})}function Mr(r){if(r==null&&typeof navigator<"u"&&(r=navigator.userAgent),!r)return!0;const e=/Edge\/(\d+\.\d+)/.exec(r);if(!e)return!0;const t=e[1];let[s,i]=t.split(".");return s=parseInt(s,10),i=parseInt(i,10),s<15||s===15&&i<15063||s>18||s===18&&i>=18218}function qr(r,e){return e.name?e.name:r.split("/")[0]==="image"?`${r.split("/")[0]}.${r.split("/")[1]}`:"noname"}function Ke(r){return r<10?`0${r}`:r.toString()}function Ie(){const r=new Date,e=Ke(r.getHours()),t=Ke(r.getMinutes()),s=Ke(r.getSeconds());return`${e}:${t}:${s}`}const Ir={debug:()=>{},warn:()=>{},error:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return console.error(`[Uppy] [${Ie()}]`,...e)}},zr={debug:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return console.debug(`[Uppy] [${Ie()}]`,...e)},warn:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return console.warn(`[Uppy] [${Ie()}]`,...e)},error:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return console.error(`[Uppy] [${Ie()}]`,...e)}};var Br=function(e){if(typeof e!="number"||isNaN(e))throw new TypeError(`Expected a number, got ${typeof e}`);const t=e<0,s=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];if(t&&(e=-e),e<1)return`${(t?"-":"")+e} B`;const i=Math.min(Math.floor(Math.log(e)/Math.log(1024)),s.length-1);e=Number(e/Math.pow(1024,i));const o=s[i];return e>=10||e%1===0?`${(t?"-":"")+e.toFixed(0)} ${o}`:`${(t?"-":"")+e.toFixed(1)} ${o}`};const Ge=ze(Br);function Ht(r,e){this.text=r=r||"",this.hasWild=~r.indexOf("*"),this.separator=e,this.parts=r.split(e)}Ht.prototype.match=function(r){var e=!0,t=this.parts,s,i=t.length,o;if(typeof r=="string"||r instanceof String)if(!this.hasWild&&this.text!=r)e=!1;else{for(o=(r||"").split(this.separator),s=0;e&&s<i;s++)t[s]!=="*"&&(s<o.length?e=t[s]===o[s]:e=!1);e=e&&o}else if(typeof r.splice=="function")for(e=[],s=r.length;s--;)this.match(r[s])&&(e[e.length]=r[s]);else if(typeof r=="object"){e={};for(var a in r)this.match(a)&&(e[a]=r[a])}return e};var Hr=function(r,e,t){var s=new Ht(r,t||/[\/\.]/);return typeof e<"u"?s.match(e):s},Dr=Hr,Wr=/[\/\+\.]/,Kr=function(r,e){function t(s){var i=Dr(s,r,Wr);return i&&i.length>=2}return e?t(e.split(";")[0]):t};const Gr=ze(Kr),Xr={maxFileSize:null,minFileSize:null,maxTotalFileSize:null,maxNumberOfFiles:null,minNumberOfFiles:null,allowedFileTypes:null,requiredMetaFields:[]};class M extends Error{constructor(e,t){let{isUserFacing:s=!0,file:i}=t===void 0?{}:t;super(e),this.isRestriction=!0,this.isUserFacing=s,i!=null&&(this.file=i)}}class Vr{constructor(e,t){this.i18n=t,this.getOpts=()=>{const s=e();if(s.restrictions.allowedFileTypes!=null&&!Array.isArray(s.restrictions.allowedFileTypes))throw new TypeError("`restrictions.allowedFileTypes` must be an array");return s}}validateAggregateRestrictions(e,t){const{maxTotalFileSize:s,maxNumberOfFiles:i}=this.getOpts().restrictions;if(i&&e.filter(a=>!a.isGhost).length+t.length>i)throw new M(`${this.i18n("youCanOnlyUploadX",{smart_count:i})}`);if(s){let o=e.reduce((a,n)=>a+n.size,0);for(const a of t)if(a.size!=null&&(o+=a.size,o>s))throw new M(this.i18n("exceedsSize",{size:Ge(s),file:a.name}))}}validateSingleFile(e){const{maxFileSize:t,minFileSize:s,allowedFileTypes:i}=this.getOpts().restrictions;if(i&&!i.some(a=>a.includes("/")?e.type?Gr(e.type.replace(/;.*?$/,""),a):!1:a[0]==="."&&e.extension?e.extension.toLowerCase()===a.slice(1).toLowerCase():!1)){const a=i.join(", ");throw new M(this.i18n("youCanOnlyUploadFileTypes",{types:a}),{file:e})}if(t&&e.size!=null&&e.size>t)throw new M(this.i18n("exceedsSize",{size:Ge(t),file:e.name}),{file:e});if(s&&e.size!=null&&e.size<s)throw new M(this.i18n("inferiorSize",{size:Ge(s)}),{file:e})}validate(e,t){t.forEach(s=>{this.validateSingleFile(s)}),this.validateAggregateRestrictions(e,t)}validateMinNumberOfFiles(e){const{minNumberOfFiles:t}=this.getOpts().restrictions;if(Object.keys(e).length<t)throw new M(this.i18n("youHaveToAtLeastSelectX",{smart_count:t}))}getMissingRequiredMetaFields(e){const t=new M(this.i18n("missingRequiredMetaFieldOnFile",{fileName:e.name})),{requiredMetaFields:s}=this.getOpts().restrictions,i=[];for(const o of s)(!Object.hasOwn(e.meta,o)||e.meta[o]==="")&&i.push(o);return{missingFields:i,error:t}}}const Jr={strings:{addBulkFilesFailed:{0:"Failed to add %{smart_count} file due to an internal error",1:"Failed to add %{smart_count} files due to internal errors"},youCanOnlyUploadX:{0:"You can only upload %{smart_count} file",1:"You can only upload %{smart_count} files"},youHaveToAtLeastSelectX:{0:"You have to select at least %{smart_count} file",1:"You have to select at least %{smart_count} files"},exceedsSize:"%{file} exceeds maximum allowed size of %{size}",missingRequiredMetaField:"Missing required meta fields",missingRequiredMetaFieldOnFile:"Missing required meta fields in %{fileName}",inferiorSize:"This file is smaller than the allowed size of %{size}",youCanOnlyUploadFileTypes:"You can only upload: %{types}",noMoreFilesAllowed:"Cannot add more files",noDuplicates:"Cannot add the duplicate file '%{fileName}', it already exists",companionError:"Connection with Companion failed",authAborted:"Authentication aborted",companionUnauthorizeHint:"To unauthorize to your %{provider} account, please go to %{url}",failedToUpload:"Failed to upload %{file}",noInternetConnection:"No Internet connection",connectedToInternet:"Connected to the Internet",noFilesFound:"You have no files or folders here",noSearchResults:"Unfortunately, there are no results for this search",selectX:{0:"Select %{smart_count}",1:"Select %{smart_count}"},allFilesFromFolderNamed:"All files from folder %{name}",openFolderNamed:"Open folder %{name}",cancel:"Cancel",logOut:"Log out",filter:"Filter",resetFilter:"Reset filter",loading:"Loading...",loadedXFiles:"Loaded %{numFiles} files",authenticateWithTitle:"Please authenticate with %{pluginName} to select files",authenticateWith:"Connect to %{pluginName}",signInWithGoogle:"Sign in with Google",searchImages:"Search for images",enterTextToSearch:"Enter text to search for images",search:"Search",resetSearch:"Reset search",emptyFolderAdded:"No files were added from empty folder",addedNumFiles:"Added %{numFiles} file(s)",folderAlreadyAdded:'The folder "%{folder}" was already added',folderAdded:{0:"Added %{smart_count} file from %{folder}",1:"Added %{smart_count} files from %{folder}"},additionalRestrictionsFailed:"%{count} additional restrictions were not fulfilled"}};let Dt,Wt;function p(r,e){if(!Object.prototype.hasOwnProperty.call(r,e))throw new TypeError("attempted to use private field on non-instance");return r}var Yr=0;function S(r){return"__private_"+Yr+++"_"+r}const Qr={version:"3.5.1"};var E=S("plugins"),R=S("restricter"),we=S("storeUnsubscribe"),B=S("emitter"),ue=S("preProcessors"),ce=S("uploaders"),Y=S("postProcessors"),k=S("informAndEmit"),Ae=S("checkRequiredMetaFieldsOnFile"),Xe=S("checkRequiredMetaFields"),be=S("assertNewUploadAllowed"),ot=S("transformFile"),Se=S("startIfAutoProceed"),Fe=S("checkAndUpdateFileState"),Ve=S("addListeners"),q=S("updateOnlineStatus"),H=S("createUpload"),Je=S("getUpload"),pe=S("removeUpload"),D=S("runUpload");Dt=Symbol.for("uppy test: getPlugins");Wt=Symbol.for("uppy test: createUpload");class Kt{constructor(e){Object.defineProperty(this,D,{value:ui}),Object.defineProperty(this,pe,{value:di}),Object.defineProperty(this,Je,{value:li}),Object.defineProperty(this,H,{value:ai}),Object.defineProperty(this,Ve,{value:ni}),Object.defineProperty(this,Fe,{value:oi}),Object.defineProperty(this,Se,{value:ii}),Object.defineProperty(this,ot,{value:ri}),Object.defineProperty(this,be,{value:si}),Object.defineProperty(this,Xe,{value:ti}),Object.defineProperty(this,Ae,{value:ei}),Object.defineProperty(this,k,{value:Zr}),Object.defineProperty(this,E,{writable:!0,value:Object.create(null)}),Object.defineProperty(this,R,{writable:!0,value:void 0}),Object.defineProperty(this,we,{writable:!0,value:void 0}),Object.defineProperty(this,B,{writable:!0,value:Rt()}),Object.defineProperty(this,ue,{writable:!0,value:new Set}),Object.defineProperty(this,ce,{writable:!0,value:new Set}),Object.defineProperty(this,Y,{writable:!0,value:new Set}),this.calculateProgress=Mt((s,i)=>{const o=this.getFile(s==null?void 0:s.id);if(s==null||!o){this.log(`Not setting progress for a file that has been removed: ${s==null?void 0:s.id}`);return}if(o.progress.percentage===100){this.log(`Not setting progress for a file that has been already uploaded: ${s.id}`);return}const a=Number.isFinite(i.bytesTotal)&&i.bytesTotal>0;this.setFileState(s.id,{progress:{...o.progress,bytesUploaded:i.bytesUploaded,bytesTotal:i.bytesTotal,percentage:a?Math.round(i.bytesUploaded/i.bytesTotal*100):0}}),this.calculateTotalProgress()},500,{leading:!0,trailing:!0}),Object.defineProperty(this,q,{writable:!0,value:this.updateOnlineStatus.bind(this)}),this.defaultLocale=Jr;const t={id:"uppy",autoProceed:!1,allowMultipleUploadBatches:!0,debug:!1,restrictions:Xr,meta:{},onBeforeFileAdded:(s,i)=>!Object.hasOwn(i,s.id),onBeforeUpload:s=>s,store:new It,logger:Ir,infoTimeout:5e3};this.opts={...t,...e,restrictions:{...t.restrictions,...e&&e.restrictions}},e&&e.logger&&e.debug?this.log("You are using a custom `logger`, but also set `debug: true`, which uses built-in logger to output logs to console. Ignoring `debug: true` and using your custom `logger`.","warning"):e&&e.debug&&(this.opts.logger=zr),this.log(`Using Core v${this.constructor.VERSION}`),this.i18nInit(),this.store=this.opts.store,this.setState({plugins:{},files:{},currentUploads:{},allowNewUpload:!0,capabilities:{uploadProgress:Mr(),individualCancellation:!0,resumableUploads:!1},totalProgress:0,meta:{...this.opts.meta},info:[],recoveredState:null}),p(this,R)[R]=new Vr(()=>this.opts,this.i18n),p(this,we)[we]=this.store.subscribe((s,i,o)=>{this.emit("state-update",s,i,o),this.updateAll(i)}),this.opts.debug&&typeof window<"u"&&(window[this.opts.id]=this),p(this,Ve)[Ve]()}emit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];p(this,B)[B].emit(e,...s)}on(e,t){return p(this,B)[B].on(e,t),this}once(e,t){return p(this,B)[B].once(e,t),this}off(e,t){return p(this,B)[B].off(e,t),this}updateAll(e){this.iteratePlugins(t=>{t.update(e)})}setState(e){this.store.setState(e)}getState(){return this.store.getState()}patchFilesState(e){const t=this.getState().files;this.setState({files:{...t,...Object.fromEntries(Object.entries(e).map(s=>{let[i,o]=s;return[i,{...t[i],...o}]}))}})}setFileState(e,t){if(!this.getState().files[e])throw new Error(`Can’t set state for ${e} (the file could have been removed)`);this.patchFilesState({[e]:t})}i18nInit(){const e=new jt([this.defaultLocale,this.opts.locale]);this.i18n=e.translate.bind(e),this.i18nArray=e.translateArray.bind(e),this.locale=e.locale}setOptions(e){this.opts={...this.opts,...e,restrictions:{...this.opts.restrictions,...e&&e.restrictions}},e.meta&&this.setMeta(e.meta),this.i18nInit(),e.locale&&this.iteratePlugins(t=>{t.setOptions(e)}),this.setState()}resetProgress(){const e={percentage:0,bytesUploaded:0,uploadComplete:!1,uploadStarted:null},t={...this.getState().files},s={};Object.keys(t).forEach(i=>{s[i]={...t[i],progress:{...t[i].progress,...e}}}),this.setState({files:s,totalProgress:0,allowNewUpload:!0,error:null,recoveredState:null}),this.emit("reset-progress")}addPreProcessor(e){p(this,ue)[ue].add(e)}removePreProcessor(e){return p(this,ue)[ue].delete(e)}addPostProcessor(e){p(this,Y)[Y].add(e)}removePostProcessor(e){return p(this,Y)[Y].delete(e)}addUploader(e){p(this,ce)[ce].add(e)}removeUploader(e){return p(this,ce)[ce].delete(e)}setMeta(e){const t={...this.getState().meta,...e},s={...this.getState().files};Object.keys(s).forEach(i=>{s[i]={...s[i],meta:{...s[i].meta,...e}}}),this.log("Adding metadata:"),this.log(e),this.setState({meta:t,files:s})}setFileMeta(e,t){const s={...this.getState().files};if(!s[e]){this.log("Was trying to set metadata for a file that has been removed: ",e);return}const i={...s[e].meta,...t};s[e]={...s[e],meta:i},this.setState({files:s})}getFile(e){return this.getState().files[e]}getFiles(){const{files:e}=this.getState();return Object.values(e)}getFilesByIds(e){return e.map(t=>this.getFile(t))}getObjectOfFilesPerState(){const{files:e,totalProgress:t,error:s}=this.getState(),i=Object.values(e),o=i.filter(v=>{let{progress:z}=v;return!z.uploadComplete&&z.uploadStarted}),a=i.filter(v=>!v.progress.uploadStarted),n=i.filter(v=>v.progress.uploadStarted||v.progress.preprocess||v.progress.postprocess),l=i.filter(v=>v.progress.uploadStarted),d=i.filter(v=>v.isPaused),u=i.filter(v=>v.progress.uploadComplete),c=i.filter(v=>v.error),h=o.filter(v=>!v.isPaused),m=i.filter(v=>v.progress.preprocess||v.progress.postprocess);return{newFiles:a,startedFiles:n,uploadStartedFiles:l,pausedFiles:d,completeFiles:u,erroredFiles:c,inProgressFiles:o,inProgressNotPausedFiles:h,processingFiles:m,isUploadStarted:l.length>0,isAllComplete:t===100&&u.length===i.length&&m.length===0,isAllErrored:!!s&&c.length===i.length,isAllPaused:o.length!==0&&d.length===o.length,isUploadInProgress:o.length>0,isSomeGhost:i.some(v=>v.isGhost)}}validateRestrictions(e,t){t===void 0&&(t=this.getFiles());try{p(this,R)[R].validate(t,[e])}catch(s){return s}return null}checkIfFileAlreadyExists(e){const{files:t}=this.getState();return!!(t[e]&&!t[e].isGhost)}addFile(e){p(this,be)[be](e);const{nextFilesState:t,validFilesToAdd:s,errors:i}=p(this,Fe)[Fe]([e]),o=i.filter(n=>n.isRestriction);if(p(this,k)[k](o),i.length>0)throw i[0];this.setState({files:t});const[a]=s;return this.emit("file-added",a),this.emit("files-added",s),this.log(`Added file: ${a.name}, ${a.id}, mime type: ${a.type}`),p(this,Se)[Se](),a.id}addFiles(e){p(this,be)[be]();const{nextFilesState:t,validFilesToAdd:s,errors:i}=p(this,Fe)[Fe](e),o=i.filter(n=>n.isRestriction);p(this,k)[k](o);const a=i.filter(n=>!n.isRestriction);if(a.length>0){let n=`Multiple errors occurred while adding files:
`;if(a.forEach(l=>{n+=`
 * ${l.message}`}),this.info({message:this.i18n("addBulkFilesFailed",{smart_count:a.length}),details:n},"error",this.opts.infoTimeout),typeof AggregateError=="function")throw new AggregateError(a,n);{const l=new Error(n);throw l.errors=a,l}}this.setState({files:t}),s.forEach(n=>{this.emit("file-added",n)}),this.emit("files-added",s),s.length>5?this.log(`Added batch of ${s.length} files`):Object.values(s).forEach(n=>{this.log(`Added file: ${n.name}
 id: ${n.id}
 type: ${n.type}`)}),s.length>0&&p(this,Se)[Se]()}removeFiles(e,t){const{files:s,currentUploads:i}=this.getState(),o={...s},a={...i},n=Object.create(null);e.forEach(c=>{s[c]&&(n[c]=s[c],delete o[c])});function l(c){return n[c]===void 0}Object.keys(a).forEach(c=>{const h=i[c].fileIDs.filter(l);if(h.length===0){delete a[c];return}const{capabilities:m}=this.getState();if(h.length!==i[c].fileIDs.length&&!m.individualCancellation)throw new Error("individualCancellation is disabled");a[c]={...i[c],fileIDs:h}});const d={currentUploads:a,files:o};Object.keys(o).length===0&&(d.allowNewUpload=!0,d.error=null,d.recoveredState=null),this.setState(d),this.calculateTotalProgress();const u=Object.keys(n);u.forEach(c=>{this.emit("file-removed",n[c],t)}),u.length>5?this.log(`Removed ${u.length} files`):this.log(`Removed files: ${u.join(", ")}`)}removeFile(e,t){t===void 0&&(t=null),this.removeFiles([e],t)}pauseResume(e){if(!this.getState().capabilities.resumableUploads||this.getFile(e).uploadComplete)return;const s=!(this.getFile(e).isPaused||!1);return this.setFileState(e,{isPaused:s}),this.emit("upload-pause",e,s),s}pauseAll(){const e={...this.getState().files};Object.keys(e).filter(s=>!e[s].progress.uploadComplete&&e[s].progress.uploadStarted).forEach(s=>{const i={...e[s],isPaused:!0};e[s]=i}),this.setState({files:e}),this.emit("pause-all")}resumeAll(){const e={...this.getState().files};Object.keys(e).filter(s=>!e[s].progress.uploadComplete&&e[s].progress.uploadStarted).forEach(s=>{const i={...e[s],isPaused:!1,error:null};e[s]=i}),this.setState({files:e}),this.emit("resume-all")}retryAll(){const e={...this.getState().files},t=Object.keys(e).filter(i=>e[i].error);if(t.forEach(i=>{const o={...e[i],isPaused:!1,error:null};e[i]=o}),this.setState({files:e,error:null}),this.emit("retry-all",t),t.length===0)return Promise.resolve({successful:[],failed:[]});const s=p(this,H)[H](t,{forceAllowNewUpload:!0});return p(this,D)[D](s)}cancelAll(e){let{reason:t="user"}=e===void 0?{}:e;if(this.emit("cancel-all",{reason:t}),t==="user"){const{files:s}=this.getState(),i=Object.keys(s);i.length&&this.removeFiles(i,"cancel-all"),this.setState({totalProgress:0,error:null,recoveredState:null})}}retryUpload(e){this.setFileState(e,{error:null,isPaused:!1}),this.emit("upload-retry",e);const t=p(this,H)[H]([e],{forceAllowNewUpload:!0});return p(this,D)[D](t)}logout(){this.iteratePlugins(e=>{e.provider&&e.provider.logout&&e.provider.logout()})}calculateTotalProgress(){const t=this.getFiles().filter(d=>d.progress.uploadStarted||d.progress.preprocess||d.progress.postprocess);if(t.length===0){this.emit("progress",0),this.setState({totalProgress:0});return}const s=t.filter(d=>d.progress.bytesTotal!=null),i=t.filter(d=>d.progress.bytesTotal==null);if(s.length===0){const d=t.length*100,u=i.reduce((h,m)=>h+m.progress.percentage,0),c=Math.round(u/d*100);this.setState({totalProgress:c});return}let o=s.reduce((d,u)=>d+u.progress.bytesTotal,0);const a=o/s.length;o+=a*i.length;let n=0;s.forEach(d=>{n+=d.progress.bytesUploaded}),i.forEach(d=>{n+=a*(d.progress.percentage||0)/100});let l=o===0?0:Math.round(n/o*100);l>100&&(l=100),this.setState({totalProgress:l}),this.emit("progress",l)}updateOnlineStatus(){(typeof window.navigator.onLine<"u"?window.navigator.onLine:!0)?(this.emit("is-online"),this.wasOffline&&(this.emit("back-online"),this.info(this.i18n("connectedToInternet"),"success",3e3),this.wasOffline=!1)):(this.emit("is-offline"),this.info(this.i18n("noInternetConnection"),"error",0),this.wasOffline=!0)}getID(){return this.opts.id}use(e,t){if(typeof e!="function"){const a=`Expected a plugin class, but got ${e===null?"null":typeof e}. Please verify that the plugin was imported and spelled correctly.`;throw new TypeError(a)}const s=new e(this,t),i=s.id;if(!i)throw new Error("Your plugin must have an id");if(!s.type)throw new Error("Your plugin must have a type");const o=this.getPlugin(i);if(o){const a=`Already found a plugin named '${o.id}'. Tried to use: '${i}'.
Uppy plugins must have unique \`id\` options. See https://uppy.io/docs/plugins/#id.`;throw new Error(a)}return e.VERSION&&this.log(`Using ${i} v${e.VERSION}`),s.type in p(this,E)[E]?p(this,E)[E][s.type].push(s):p(this,E)[E][s.type]=[s],s.install(),this}getPlugin(e){for(const t of Object.values(p(this,E)[E])){const s=t.find(i=>i.id===e);if(s!=null)return s}}[Dt](e){return p(this,E)[E][e]}iteratePlugins(e){Object.values(p(this,E)[E]).flat(1).forEach(e)}removePlugin(e){this.log(`Removing plugin ${e.id}`),this.emit("plugin-remove",e),e.uninstall&&e.uninstall();const t=p(this,E)[E][e.type],s=t.findIndex(a=>a.id===e.id);s!==-1&&t.splice(s,1);const o={plugins:{...this.getState().plugins,[e.id]:void 0}};this.setState(o)}close(e){let{reason:t}=e===void 0?{}:e;this.log(`Closing Uppy instance ${this.opts.id}: removing all files and uninstalling plugins`),this.cancelAll({reason:t}),p(this,we)[we](),this.iteratePlugins(s=>{this.removePlugin(s)}),typeof window<"u"&&window.removeEventListener&&(window.removeEventListener("online",p(this,q)[q]),window.removeEventListener("offline",p(this,q)[q]))}hideInfo(){const{info:e}=this.getState();this.setState({info:e.slice(1)}),this.emit("info-hidden")}info(e,t,s){t===void 0&&(t="info"),s===void 0&&(s=3e3);const i=typeof e=="object";this.setState({info:[...this.getState().info,{type:t,message:i?e.message:e,details:i?e.details:null}]}),setTimeout(()=>this.hideInfo(),s),this.emit("info-visible")}log(e,t){const{logger:s}=this.opts;switch(t){case"error":s.error(e);break;case"warning":s.warn(e);break;default:s.debug(e);break}}restore(e){return this.log(`Core: attempting to restore upload "${e}"`),this.getState().currentUploads[e]?p(this,D)[D](e):(p(this,pe)[pe](e),Promise.reject(new Error("Nonexistent upload")))}[Wt](){return p(this,H)[H](...arguments)}addResultData(e,t){if(!p(this,Je)[Je](e)){this.log(`Not setting result for an upload that has been removed: ${e}`);return}const{currentUploads:s}=this.getState(),i={...s[e],result:{...s[e].result,...t}};this.setState({currentUploads:{...s,[e]:i}})}upload(){var e;(e=p(this,E)[E].uploader)!=null&&e.length||this.log("No uploader type plugins are used","warning");let{files:t}=this.getState();const s=this.opts.onBeforeUpload(t);return s===!1?Promise.reject(new Error("Not starting the upload because onBeforeUpload returned false")):(s&&typeof s=="object"&&(t=s,this.setState({files:t})),Promise.resolve().then(()=>p(this,R)[R].validateMinNumberOfFiles(t)).catch(i=>{throw p(this,k)[k]([i]),i}).then(()=>{if(!p(this,Xe)[Xe](t))throw new M(this.i18n("missingRequiredMetaField"))}).catch(i=>{throw i}).then(()=>{const{currentUploads:i}=this.getState(),o=Object.values(i).flatMap(l=>l.fileIDs),a=[];Object.keys(t).forEach(l=>{const d=this.getFile(l);!d.progress.uploadStarted&&o.indexOf(l)===-1&&a.push(d.id)});const n=p(this,H)[H](a);return p(this,D)[D](n)}).catch(i=>{throw this.emit("error",i),this.log(i,"error"),i}))}}function Zr(r){for(const o of r){const{file:a,isRestriction:n}=o;n?this.emit("restriction-failed",a,o):this.emit("error",o),this.log(o,"warning")}const e=r.filter(o=>o.isUserFacing),t=4,s=e.slice(0,t),i=e.slice(t);s.forEach(o=>{let{message:a,details:n=""}=o;this.info({message:a,details:n},"error",this.opts.infoTimeout)}),i.length>0&&this.info({message:this.i18n("additionalRestrictionsFailed",{count:i.length})})}function ei(r){const{missingFields:e,error:t}=p(this,R)[R].getMissingRequiredMetaFields(r);return e.length>0?(this.setFileState(r.id,{missingRequiredMetaFields:e}),this.log(t.message),this.emit("restriction-failed",r,t),!1):!0}function ti(r){let e=!0;for(const t of Object.values(r))p(this,Ae)[Ae](t)||(e=!1);return e}function si(r){const{allowNewUpload:e}=this.getState();if(e===!1){const t=new M(this.i18n("noMoreFilesAllowed"),{file:r});throw p(this,k)[k]([t]),t}}function ri(r){const e=r instanceof File?{name:r.name,type:r.type,size:r.size,data:r}:r,t=Bt(e),s=qr(t,e),i=zt(s).extension,o=!!e.isRemote,a=Nr(e),n=e.meta||{};n.name=s,n.type=t;const l=Number.isFinite(e.data.size)?e.data.size:null;return{source:e.source||"",id:a,name:s,extension:i||"",meta:{...this.getState().meta,...n},type:t,data:e.data,progress:{percentage:0,bytesUploaded:0,bytesTotal:l,uploadComplete:!1,uploadStarted:null},size:l,isRemote:o,remote:e.remote||"",preview:e.preview}}function ii(){this.opts.autoProceed&&!this.scheduledAutoProceed&&(this.scheduledAutoProceed=setTimeout(()=>{this.scheduledAutoProceed=null,this.upload().catch(r=>{r.isRestriction||this.log(r.stack||r.message||r)})},4))}function oi(r){const{files:e}=this.getState(),t={...e},s=[],i=[];for(const a of r)try{var o;let n=p(this,ot)[ot](a);if((o=e[n.id])!=null&&o.isGhost){const{isGhost:d,...u}=e[n.id];n={...u,data:a.data},this.log(`Replaced the blob in the restored ghost file: ${n.name}, ${n.id}`)}const l=this.opts.onBeforeFileAdded(n,t);if(!l&&this.checkIfFileAlreadyExists(n.id))throw new M(this.i18n("noDuplicates",{fileName:n.name}),{file:a});if(l===!1)throw new M("Cannot add the file because onBeforeFileAdded returned false.",{isUserFacing:!1,file:a});typeof l=="object"&&l!==null&&(n=l),p(this,R)[R].validateSingleFile(n),t[n.id]=n,s.push(n)}catch(n){i.push(n)}try{p(this,R)[R].validateAggregateRestrictions(Object.values(e),s)}catch(a){return i.push(a),{nextFilesState:e,validFilesToAdd:[],errors:i}}return{nextFilesState:t,validFilesToAdd:s,errors:i}}function ni(){const r=(s,i,o)=>{let a=s.message||"Unknown error";s.details&&(a+=` ${s.details}`),this.setState({error:a}),i!=null&&i.id in this.getState().files&&this.setFileState(i.id,{error:a,response:o})};this.on("error",r),this.on("upload-error",(s,i,o)=>{if(r(i,s,o),typeof i=="object"&&i.message){this.log(i.message,"error");const a=new Error(this.i18n("failedToUpload",{file:s==null?void 0:s.name}));a.isUserFacing=!0,a.details=i.message,i.details&&(a.details+=` ${i.details}`),p(this,k)[k]([a])}else p(this,k)[k]([i])});let e;this.on("upload-stalled",(s,i)=>{const{message:o}=s,a=i.map(n=>n.meta.name).join(", ");e||(this.info({message:o,details:a},"warning",this.opts.infoTimeout),e=setTimeout(()=>{e=null},this.opts.infoTimeout)),this.log(`${o} ${a}`.trim(),"warning")}),this.on("upload",()=>{this.setState({error:null})});const t=s=>{const i=s.filter(a=>{const n=a!=null&&this.getFile(a.id);return n||this.log(`Not setting progress for a file that has been removed: ${a==null?void 0:a.id}`),n}),o=Object.fromEntries(i.map(a=>[a.id,{progress:{uploadStarted:Date.now(),uploadComplete:!1,percentage:0,bytesUploaded:0,bytesTotal:a.size}}]));this.patchFilesState(o)};this.on("upload-start",s=>{s.forEach(i=>{this.emit("upload-started",i)}),t(s)}),this.on("upload-progress",this.calculateProgress),this.on("upload-success",(s,i)=>{if(s==null||!this.getFile(s.id)){this.log(`Not setting progress for a file that has been removed: ${s==null?void 0:s.id}`);return}const o=this.getFile(s.id).progress;this.setFileState(s.id,{progress:{...o,postprocess:p(this,Y)[Y].size>0?{mode:"indeterminate"}:null,uploadComplete:!0,percentage:100,bytesUploaded:o.bytesTotal},response:i,uploadURL:i.uploadURL,isPaused:!1}),s.size==null&&this.setFileState(s.id,{size:i.bytesUploaded||o.bytesTotal}),this.calculateTotalProgress()}),this.on("preprocess-progress",(s,i)=>{if(s==null||!this.getFile(s.id)){this.log(`Not setting progress for a file that has been removed: ${s==null?void 0:s.id}`);return}this.setFileState(s.id,{progress:{...this.getFile(s.id).progress,preprocess:i}})}),this.on("preprocess-complete",s=>{if(s==null||!this.getFile(s.id)){this.log(`Not setting progress for a file that has been removed: ${s==null?void 0:s.id}`);return}const i={...this.getState().files};i[s.id]={...i[s.id],progress:{...i[s.id].progress}},delete i[s.id].progress.preprocess,this.setState({files:i})}),this.on("postprocess-progress",(s,i)=>{if(s==null||!this.getFile(s.id)){this.log(`Not setting progress for a file that has been removed: ${s==null?void 0:s.id}`);return}this.setFileState(s.id,{progress:{...this.getState().files[s.id].progress,postprocess:i}})}),this.on("postprocess-complete",s=>{if(s==null||!this.getFile(s.id)){this.log(`Not setting progress for a file that has been removed: ${s==null?void 0:s.id}`);return}const i={...this.getState().files};i[s.id]={...i[s.id],progress:{...i[s.id].progress}},delete i[s.id].progress.postprocess,this.setState({files:i})}),this.on("restored",()=>{this.calculateTotalProgress()}),this.on("dashboard:file-edit-complete",s=>{s&&p(this,Ae)[Ae](s)}),typeof window<"u"&&window.addEventListener&&(window.addEventListener("online",p(this,q)[q]),window.addEventListener("offline",p(this,q)[q]),setTimeout(p(this,q)[q],3e3))}function ai(r,e){e===void 0&&(e={});const{forceAllowNewUpload:t=!1}=e,{allowNewUpload:s,currentUploads:i}=this.getState();if(!s&&!t)throw new Error("Cannot create a new upload: already uploading.");const o=kt();return this.emit("upload",{id:o,fileIDs:r}),this.setState({allowNewUpload:this.opts.allowMultipleUploadBatches!==!1&&this.opts.allowMultipleUploads!==!1,currentUploads:{...i,[o]:{fileIDs:r,step:0,result:{}}}}),o}function li(r){const{currentUploads:e}=this.getState();return e[r]}function di(r){const e={...this.getState().currentUploads};delete e[r],this.setState({currentUploads:e})}async function ui(r){const e=()=>{const{currentUploads:o}=this.getState();return o[r]};let t=e();const s=[...p(this,ue)[ue],...p(this,ce)[ce],...p(this,Y)[Y]];try{for(let o=t.step||0;o<s.length&&t;o++){const a=s[o];this.setState({currentUploads:{...this.getState().currentUploads,[r]:{...t,step:o}}});const{fileIDs:n}=t;await a(n,r),t=e()}}catch(o){throw p(this,pe)[pe](r),o}if(t){t.fileIDs.forEach(l=>{const d=this.getFile(l);d&&d.progress.postprocess&&this.emit("postprocess-complete",d)});const o=t.fileIDs.map(l=>this.getFile(l)),a=o.filter(l=>!l.error),n=o.filter(l=>l.error);await this.addResultData(r,{successful:a,failed:n,uploadID:r}),t=e()}let i;return t&&(i=t.result,this.emit("complete",i),p(this,pe)[pe](r)),i==null&&this.log(`Not setting result for an upload that has been removed: ${r}`),i}Kt.VERSION=Qr.version;typeof Promise=="function"&&Promise.prototype.then.bind(Promise.resolve());class Gt{constructor(e,t){t===void 0&&(t={}),this.uppy=e,this.opts=t}getPluginState(){const{plugins:e}=this.uppy.getState();return e[this.id]||{}}setPluginState(e){const{plugins:t}=this.uppy.getState();this.uppy.setState({plugins:{...t,[this.id]:{...t[this.id],...e}}})}setOptions(e){this.opts={...this.opts,...e},this.setPluginState(),this.i18nInit()}i18nInit(){const e=new jt([this.defaultLocale,this.uppy.locale,this.opts.locale]);this.i18n=e.translate.bind(e),this.i18nArray=e.translateArray.bind(e),this.setPluginState()}addTarget(){throw new Error("Extend the addTarget method to add your plugin to another plugin's target")}install(){}uninstall(){}render(){throw new Error("Extend the render method to add your plugin to a DOM element")}update(){}afterUpdate(){}}class ct extends Error{constructor(e,t){t===void 0&&(t=null),super("This looks like a network error, the endpoint might be blocked by an internet provider or a firewall."),this.cause=e,this.isNetworkError=!0,this.request=t}}function ci(){return fetch(...arguments).catch(r=>{throw r.name==="AbortError"?r:new ct(r)})}class pi extends Error{constructor(e,t){t===void 0&&(t={}),super(e),this.cause=t.cause,this.cause&&xt(this.cause,"isNetworkError")&&(this.isNetworkError=this.cause.isNetworkError)}}function hi(r,e,t){const{progress:s,bytesUploaded:i,bytesTotal:o}=e;s&&(r.uppy.log(`Upload progress: ${s}`),r.uppy.emit("upload-progress",t,{uploader:r,bytesUploaded:i,bytesTotal:o}))}const fi=Mt(hi,300,{leading:!0,trailing:!0});function mi(r){const t=/^(?:https?:\/\/|\/\/)?(?:[^@\n]+@)?(?:www\.)?([^\n]+)/i.exec(r)[1];return`${/^http:\/\//i.test(r)?"ws":"wss"}://${t}`}function W(r,e){if(!Object.prototype.hasOwnProperty.call(r,e))throw new TypeError("attempted to use private field on non-instance");return r}var gi=0;function Xt(r){return"__private_"+gi+++"_"+r}var O=Xt("uppy"),Pe=Xt("events");class Vt{constructor(e){Object.defineProperty(this,O,{writable:!0,value:void 0}),Object.defineProperty(this,Pe,{writable:!0,value:[]}),W(this,O)[O]=e}on(e,t){return W(this,Pe)[Pe].push([e,t]),W(this,O)[O].on(e,t)}remove(){for(const[e,t]of W(this,Pe)[Pe].splice(0))W(this,O)[O].off(e,t)}onFilePause(e,t){this.on("upload-pause",(s,i)=>{e===s&&t(i)})}onFileRemove(e,t){this.on("file-removed",s=>{e===s.id&&t(s.id)})}onPause(e,t){this.on("upload-pause",(s,i)=>{e===s&&t(i)})}onRetry(e,t){this.on("upload-retry",s=>{e===s&&t()})}onRetryAll(e,t){this.on("retry-all",()=>{W(this,O)[O].getFile(e)&&t()})}onPauseAll(e,t){this.on("pause-all",()=>{W(this,O)[O].getFile(e)&&t()})}onCancelAll(e,t){var s=this;this.on("cancel-all",function(){W(s,O)[O].getFile(e)&&t(...arguments)})}onResumeAll(e,t){this.on("resume-all",()=>{W(this,O)[O].getFile(e)&&t()})}}class vi extends Error{constructor(){super("Authorization required"),this.name="AuthError",this.isAuthError=!0}}let Jt,Yt;function y(r,e){if(!Object.prototype.hasOwnProperty.call(r,e))throw new TypeError("attempted to use private field on non-instance");return r}var yi=0;function xe(r){return"__private_"+yi+++"_"+r}var K=xe("queued"),se=xe("emitter"),C=xe("isOpen"),F=xe("socket"),Ye=xe("handleMessage");Jt=Symbol.for("uppy test: getSocket");Yt=Symbol.for("uppy test: getQueued");class wi{constructor(e){Object.defineProperty(this,K,{writable:!0,value:[]}),Object.defineProperty(this,se,{writable:!0,value:Rt()}),Object.defineProperty(this,C,{writable:!0,value:!1}),Object.defineProperty(this,F,{writable:!0,value:void 0}),Object.defineProperty(this,Ye,{writable:!0,value:t=>{try{const s=JSON.parse(t.data);this.emit(s.action,s.payload)}catch(s){console.log(s)}}}),this.opts=e,(!e||e.autoOpen!==!1)&&this.open()}get isOpen(){return y(this,C)[C]}[Jt](){return y(this,F)[F]}[Yt](){return y(this,K)[K]}open(){y(this,F)[F]==null&&(y(this,F)[F]=new WebSocket(this.opts.target),y(this,F)[F].onopen=()=>{for(y(this,C)[C]=!0;y(this,K)[K].length>0&&y(this,C)[C];){const e=y(this,K)[K].shift();this.send(e.action,e.payload)}},y(this,F)[F].onclose=()=>{y(this,C)[C]=!1,y(this,F)[F]=null},y(this,F)[F].onmessage=y(this,Ye)[Ye])}close(){var e;(e=y(this,F)[F])==null||e.close()}send(e,t){if(!y(this,C)[C]){y(this,K)[K].push({action:e,payload:t});return}y(this,F)[F].send(JSON.stringify({action:e,payload:t}))}on(e,t){y(this,se)[se].on(e,t)}emit(e,t){y(this,se)[se].emit(e,t)}once(e,t){y(this,se)[se].once(e,t)}}let Qt;function te(r,e){if(!Object.prototype.hasOwnProperty.call(r,e))throw new TypeError("attempted to use private field on non-instance");return r}var bi=0;function pt(r){return"__private_"+bi+++"_"+r}const Si={version:"3.4.1"};function Fi(r){return r.replace(/\/$/,"")}async function Pi(r){if(r.status===401)throw new vi;const e=r.json();if(r.ok)return e;let t=`Failed request with status: ${r.status}. ${r.statusText}`;try{const s=await e;t=s.message?`${t} message: ${s.message}`:t,t=s.requestId?`${t} request-Id: ${s.requestId}`:t}catch{}throw new Error(t)}const Ee=new Map;var G=pt("companionHeaders"),re=pt("getUrl"),Qe=pt("requestSocketToken");Qt=Symbol.for("uppy test: getCompanionHeaders");class je{constructor(e,t,s){Object.defineProperty(this,re,{value:Ei}),Object.defineProperty(this,G,{writable:!0,value:void 0}),Object.defineProperty(this,Qe,{writable:!0,value:async(i,o)=>{if(i.remote.url==null)throw new Error("Cannot connect to an undefined URL");return(await this.post(i.remote.url,{...i.remote.body,...o})).token}}),this.uppy=e,this.opts=t,this.getQueue=s,this.onReceiveResponse=this.onReceiveResponse.bind(this),te(this,G)[G]=t==null?void 0:t.companionHeaders}setCompanionHeaders(e){te(this,G)[G]=e}[Qt](){return te(this,G)[G]}get hostname(){const{companion:e}=this.uppy.getState(),t=this.opts.companionUrl;return Fi(e&&e[t]?e[t]:t)}async headers(){return{...{Accept:"application/json","Content-Type":"application/json","Uppy-Versions":`@uppy/companion-client=${je.VERSION}`},...te(this,G)[G]}}onReceiveResponse(e){let{headers:t}=e;const i=this.uppy.getState().companion||{},o=this.opts.companionUrl;t.has("i-am")&&t.get("i-am")!==i[o]&&this.uppy.setState({companion:{...i,[o]:t.get("i-am")}})}async preflight(e){const t=Ee.get(this.hostname);if(t!=null)return t;const s=["accept","content-type","uppy-auth-token"],i=(async()=>{try{const a=(await fetch(te(this,re)[re](e),{method:"OPTIONS"})).headers.get("access-control-allow-headers");if(a==null||a==="*")return Ee.set(this.hostname,s),s;this.uppy.log(`[CompanionClient] adding allowed preflight headers to companion cache: ${this.hostname} ${a}`);const n=a.split(",").map(l=>l.trim().toLowerCase());return Ee.set(this.hostname,n),n}catch(o){return this.uppy.log(`[CompanionClient] unable to make preflight request ${o}`,"warning"),Ee.delete(this.hostname),s}})();return Ee.set(this.hostname,i),i}async preflightAndHeaders(e){const[t,s]=await Promise.all([this.preflight(e),this.headers()]);return Object.fromEntries(Object.entries(s).filter(i=>{let[o]=i;return t.includes(o.toLowerCase())?!0:(this.uppy.log(`[CompanionClient] excluding disallowed header ${o}`),!1)}))}async request(e){let{path:t,method:s="GET",data:i,skipPostResponse:o,signal:a}=e;try{const n=await this.preflightAndHeaders(t),l=await ci(te(this,re)[re](t),{method:s,signal:a,headers:n,credentials:this.opts.companionCookiesRule||"same-origin",body:i?JSON.stringify(i):null});return o||this.onReceiveResponse(l),Pi(l)}catch(n){throw n!=null&&n.isAuthError?n:new pi(`Could not ${s} ${te(this,re)[re](t)}`,{cause:n})}}async get(e,t){return t===void 0&&(t=void 0),typeof t=="boolean"&&(t={skipPostResponse:t}),this.request({...t,path:e})}async post(e,t,s){return s===void 0&&(s=void 0),typeof s=="boolean"&&(s={skipPostResponse:s}),this.request({...s,path:e,method:"POST",data:t})}async delete(e,t,s){return t===void 0&&(t=void 0),typeof s=="boolean"&&(s={skipPostResponse:s}),this.request({...s,path:e,method:"DELETE",data:t})}async uploadRemoteFile(e,t,s){s===void 0&&(s={});try{if(e.serverToken)return await this.connectToServerSocket(e,this.getQueue());const a=await this.getQueue().wrapPromiseFunction(te(this,Qe)[Qe],{priority:-1})(e,t).abortOn(s.signal);return this.uppy.getState().files[e.id]?(this.uppy.setFileState(e.id,{serverToken:a}),await this.connectToServerSocket(this.uppy.getFile(e.id),this.getQueue())):void 0}catch(o){var i;if((o==null||(i=o.cause)==null?void 0:i.name)==="AbortError")return;throw this.uppy.setFileState(e.id,{serverToken:void 0}),this.uppy.emit("upload-error",e,o),o}}async connectToServerSocket(e,t){return new Promise((s,i)=>{const o=e.serverToken,a=mi(e.remote.companionUrl),n=new wi({target:`${a}/api/${o}`,autoOpen:!1}),l=new Vt(this.uppy);let d;l.onFileRemove(e.id,()=>{n.send("cancel",{}),d.abort(),s(`upload ${e.id} was removed`)}),l.onPause(e.id,u=>{u?(n.send("pause",{}),d.abort()):(d.abort(),d=t.run(()=>(n.open(),n.send("resume",{}),()=>{})))}),l.onPauseAll(e.id,()=>{n.send("pause",{}),d.abort()}),l.onCancelAll(e.id,function(u){let{reason:c}=u===void 0?{}:u;c==="user"&&(n.send("cancel",{}),d.abort()),s(`upload ${e.id} was canceled`)}),l.onResumeAll(e.id,()=>{d.abort(),e.error&&n.send("pause",{}),d=t.run(()=>(n.open(),n.send("resume",{}),()=>{}))}),l.onRetry(e.id,()=>{n.isOpen&&(n.send("pause",{}),n.send("resume",{}))}),l.onRetryAll(e.id,()=>{n.isOpen&&(n.send("pause",{}),n.send("resume",{}))}),n.on("progress",u=>fi(this,u,e)),n.on("error",u=>{const{message:c}=u.error,h=Object.assign(new Error(c),{cause:u.error});this.opts.useFastRemoteRetry?n.close():this.uppy.setFileState(e.id,{serverToken:null}),this.uppy.emit("upload-error",e,h),d.done(),i(h)}),n.on("success",u=>{const c={uploadURL:u.url};this.uppy.emit("upload-success",e,c),d.done(),n.close(),s()}),d=t.run(()=>(e.isPaused?n.send("pause",{}):n.open(),()=>{}))})}}function Ei(r){return/^(https?:|)\/\//.test(r)?r:`${this.hostname}/${r}`}je.VERSION=Si.version;function Ti(r,e){return new Promise(t=>{localStorage.setItem(r,e),t()})}function Oi(r){return Promise.resolve(localStorage.getItem(r))}function $i(r){return new Promise(e=>{localStorage.removeItem(r),e()})}const _i=Object.freeze(Object.defineProperty({__proto__:null,getItem:Oi,removeItem:$i,setItem:Ti},Symbol.toStringTag,{value:"Module"}));function X(r,e){if(!Object.prototype.hasOwnProperty.call(r,e))throw new TypeError("attempted to use private field on non-instance");return r}var Ui=0;function ht(r){return"__private_"+Ui+++"_"+r}const Ai=r=>r.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");function xi(){return location.origin}function $t(r){if(typeof r=="string")return new RegExp(`^${r}$`);if(r instanceof RegExp)return r}function ji(r,e){return(Array.isArray(e)?e.map($t):[$t(e)]).some(s=>(s==null?void 0:s.test(r))||(s==null?void 0:s.test(`${r}/`)))}var N=ht("refreshingTokenPromise"),Te=ht("getAuthToken"),Oe=ht("removeAuthToken");class Ri extends je{constructor(e,t,s){super(e,t,s),Object.defineProperty(this,Oe,{value:Li}),Object.defineProperty(this,Te,{value:ki}),Object.defineProperty(this,N,{writable:!0,value:void 0}),this.provider=t.provider,this.id=this.provider,this.name=this.opts.name||Ai(this.id),this.pluginId=this.opts.pluginId,this.tokenKey=`companion-${this.pluginId}-auth-token`,this.companionKeysParams=this.opts.companionKeysParams,this.preAuthToken=null}async headers(){const[e,t]=await Promise.all([super.headers(),X(this,Te)[Te]()]),s={};return t&&(s["uppy-auth-token"]=t),this.companionKeysParams&&(s["uppy-credentials-params"]=btoa(JSON.stringify({params:this.companionKeysParams}))),{...e,...s}}onReceiveResponse(e){super.onReceiveResponse(e);const t=this.uppy.getPlugin(this.pluginId),i=t.getPluginState().authenticated?e.status!==401:e.status<400;return t.setPluginState({authenticated:i}),e}async setAuthToken(e){return this.uppy.getPlugin(this.pluginId).storage.setItem(this.tokenKey,e)}async ensurePreAuth(){if(this.companionKeysParams&&!this.preAuthToken&&(await this.fetchPreAuthToken(),!this.preAuthToken))throw new Error("Could not load authentication data required for third-party login. Please try again later.")}authUrl(e){e===void 0&&(e={});const t=new URLSearchParams({state:btoa(JSON.stringify({origin:xi()})),...e});return this.preAuthToken&&t.set("uppyPreAuthToken",this.preAuthToken),`${this.hostname}/${this.id}/connect?${t}`}async login(e){return await this.ensurePreAuth(),new Promise((t,s)=>{const i=this.authUrl(e),o=window.open(i,"_blank"),a=n=>{if(n.source!==o){this.uppy.log.warn("ignoring event from unknown source",n);return}const{companionAllowedHosts:l}=this.uppy.getPlugin(this.pluginId).opts;if(!ji(n.origin,l)){s(new Error(`rejecting event from ${n.origin} vs allowed pattern ${l}`));return}const d=typeof n.data=="string"?JSON.parse(n.data):n.data;if(d.error){const{uppy:u}=this,c=u.i18n("authAborted");u.info({message:c},"warning",5e3),s(new Error("auth aborted"));return}if(!d.token){s(new Error("did not receive token from auth window"));return}o.close(),window.removeEventListener("message",a),this.setAuthToken(d.token),t()};window.addEventListener("message",a)})}refreshTokenUrl(){return`${this.hostname}/${this.id}/refresh-token`}fileUrl(e){return`${this.hostname}/${this.id}/get/${e}`}async request(){await X(this,N)[N];try{return await super.request(...arguments)}catch(e){if(!e.isAuthError||!await X(this,Te)[Te]())throw e;return X(this,N)[N]==null&&(X(this,N)[N]=(async()=>{try{const t=await super.request({path:this.refreshTokenUrl(),method:"POST"});await this.setAuthToken(t.uppyAuthToken)}catch(t){throw t.isAuthError&&await X(this,Oe)[Oe](),e}finally{X(this,N)[N]=void 0}})()),await X(this,N)[N],super.request(...arguments)}}async fetchPreAuthToken(){if(this.companionKeysParams)try{const e=await this.post(`${this.id}/preauth/`,{params:this.companionKeysParams});this.preAuthToken=e.token}catch(e){this.uppy.log(`[CompanionClient] unable to fetch preAuthToken ${e}`,"warning")}}list(e,t){return this.get(`${this.id}/list/${e||""}`,t)}async logout(e){const t=await this.get(`${this.id}/logout`,e);return await X(this,Oe)[Oe](),t}static initPlugin(e,t,s){if(e.type="acquirer",e.files=[],s&&(e.opts={...s,...t}),t.serverUrl||t.serverPattern)throw new Error("`serverUrl` and `serverPattern` have been renamed to `companionUrl` and `companionAllowedHosts` respectively in the 0.30.5 release. Please consult the docs (for example, https://uppy.io/docs/instagram/ for the Instagram plugin) and use the updated options.`");if(t.companionAllowedHosts){const i=t.companionAllowedHosts;if(typeof i!="string"&&!Array.isArray(i)&&!(i instanceof RegExp))throw new TypeError(`${e.id}: the option "companionAllowedHosts" must be one of string, Array, RegExp`);e.opts.companionAllowedHosts=i}else/^(?!https?:\/\/).*$/i.test(t.companionUrl)?e.opts.companionAllowedHosts=`https://${t.companionUrl.replace(/^\/\//,"")}`:e.opts.companionAllowedHosts=new URL(t.companionUrl).origin;e.storage=e.opts.storage||_i}}async function ki(){return this.uppy.getPlugin(this.pluginId).storage.getItem(this.tokenKey)}async function Li(){return this.uppy.getPlugin(this.pluginId).storage.removeItem(this.tokenKey)}function L(r,e){if(!Object.prototype.hasOwnProperty.call(r,e))throw new TypeError("attempted to use private field on non-instance");return r}var Ci=0;function Be(r){return"__private_"+Ci+++"_"+r}var V=Be("aliveTimer"),ie=Be("isDone"),$e=Be("onTimedOut"),oe=Be("timeout");class Zt{constructor(e,t){Object.defineProperty(this,V,{writable:!0,value:void 0}),Object.defineProperty(this,ie,{writable:!0,value:!1}),Object.defineProperty(this,$e,{writable:!0,value:void 0}),Object.defineProperty(this,oe,{writable:!0,value:void 0}),L(this,oe)[oe]=e,L(this,$e)[$e]=t}progress(){L(this,ie)[ie]||L(this,oe)[oe]>0&&(clearTimeout(L(this,V)[V]),L(this,V)[V]=setTimeout(L(this,$e)[$e],L(this,oe)[oe]))}done(){L(this,ie)[ie]||(clearTimeout(L(this,V)[V]),L(this,V)[V]=null,L(this,ie)[ie]=!0)}}function f(r,e){if(!Object.prototype.hasOwnProperty.call(r,e))throw new TypeError("attempted to use private field on non-instance");return r}var Ni=0;function A(r){return"__private_"+Ni+++"_"+r}function Mi(r){return new Error("Cancelled",{cause:r})}function _t(r){if(r!=null){var e;const t=()=>this.abort(r.reason);r.addEventListener("abort",t,{once:!0});const s=()=>{r.removeEventListener("abort",t)};(e=this.then)==null||e.call(this,s,s)}return this}var j=A("activeRequests"),_=A("queuedHandlers"),x=A("paused"),ne=A("pauseTimer"),$=A("downLimit"),ae=A("upperLimit"),J=A("rateLimitingTimer"),Ue=A("call"),Q=A("queueNext"),nt=A("next"),Ze=A("queue"),at=A("dequeue"),et=A("resume"),le=A("increaseLimit");class qi{constructor(e){Object.defineProperty(this,at,{value:Di}),Object.defineProperty(this,Ze,{value:Hi}),Object.defineProperty(this,nt,{value:Bi}),Object.defineProperty(this,Q,{value:zi}),Object.defineProperty(this,Ue,{value:Ii}),Object.defineProperty(this,j,{writable:!0,value:0}),Object.defineProperty(this,_,{writable:!0,value:[]}),Object.defineProperty(this,x,{writable:!0,value:!1}),Object.defineProperty(this,ne,{writable:!0,value:void 0}),Object.defineProperty(this,$,{writable:!0,value:1}),Object.defineProperty(this,ae,{writable:!0,value:void 0}),Object.defineProperty(this,J,{writable:!0,value:void 0}),Object.defineProperty(this,et,{writable:!0,value:()=>this.resume()}),Object.defineProperty(this,le,{writable:!0,value:()=>{if(f(this,x)[x]){f(this,J)[J]=setTimeout(f(this,le)[le],0);return}f(this,$)[$]=this.limit,this.limit=Math.ceil((f(this,ae)[ae]+f(this,$)[$])/2);for(let t=f(this,$)[$];t<=this.limit;t++)f(this,Q)[Q]();f(this,ae)[ae]-f(this,$)[$]>3?f(this,J)[J]=setTimeout(f(this,le)[le],2e3):f(this,$)[$]=Math.floor(f(this,$)[$]/2)}}),typeof e!="number"||e===0?this.limit=1/0:this.limit=e}run(e,t){return!f(this,x)[x]&&f(this,j)[j]<this.limit?f(this,Ue)[Ue](e):f(this,Ze)[Ze](e,t)}wrapSyncFunction(e,t){var s=this;return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];const n=s.run(()=>(e(...o),queueMicrotask(()=>n.done()),()=>{}),t);return{abortOn:_t,abort(){n.abort()}}}}wrapPromiseFunction(e,t){var s=this;return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];let n;const l=new Promise((d,u)=>{n=s.run(()=>{let c,h;try{h=Promise.resolve(e(...o))}catch(m){h=Promise.reject(m)}return h.then(m=>{c?u(c):(n.done(),d(m))},m=>{c?u(c):(n.done(),u(m))}),m=>{c=Mi(m)}},t)});return l.abort=d=>{n.abort(d)},l.abortOn=_t,l}}resume(){f(this,x)[x]=!1,clearTimeout(f(this,ne)[ne]);for(let e=0;e<this.limit;e++)f(this,Q)[Q]()}pause(e){e===void 0&&(e=null),f(this,x)[x]=!0,clearTimeout(f(this,ne)[ne]),e!=null&&(f(this,ne)[ne]=setTimeout(f(this,et)[et],e))}rateLimit(e){clearTimeout(f(this,J)[J]),this.pause(e),this.limit>1&&Number.isFinite(this.limit)&&(f(this,ae)[ae]=this.limit-1,this.limit=f(this,$)[$],f(this,J)[J]=setTimeout(f(this,le)[le],e))}get isPaused(){return f(this,x)[x]}}function Ii(r){f(this,j)[j]+=1;let e=!1,t;try{t=r()}catch(s){throw f(this,j)[j]-=1,s}return{abort:s=>{e||(e=!0,f(this,j)[j]-=1,t(s),f(this,Q)[Q]())},done:()=>{e||(e=!0,f(this,j)[j]-=1,f(this,Q)[Q]())}}}function zi(){queueMicrotask(()=>f(this,nt)[nt]())}function Bi(){if(f(this,x)[x]||f(this,j)[j]>=this.limit||f(this,_)[_].length===0)return;const r=f(this,_)[_].shift(),e=f(this,Ue)[Ue](r.fn);r.abort=e.abort,r.done=e.done}function Hi(r,e){e===void 0&&(e={});const t={fn:r,priority:e.priority||0,abort:()=>{f(this,at)[at](t)},done:()=>{throw new Error("Cannot mark a queued request as done: this indicates a bug")}},s=f(this,_)[_].findIndex(i=>t.priority>i.priority);return s===-1?f(this,_)[_].push(t):f(this,_)[_].splice(s,0,t),t}function Di(r){const e=f(this,_)[_].indexOf(r);e!==-1&&f(this,_)[_].splice(e,1)}const tt=Symbol("__queue");function es(r){return r?r.readyState!==0&&r.readyState!==4||r.status===0:!1}function Wi(r){const e=t=>"error"in t&&t.error;return r.filter(t=>!e(t))}function Ki(r){return r.filter(e=>!e.progress.uploadStarted||!e.isRestored)}const Gi={strings:{uploadStalled:"Upload has not made any progress for %{seconds} seconds. You may want to retry it."}};function fe(r,e){if(!Object.prototype.hasOwnProperty.call(r,e))throw new TypeError("attempted to use private field on non-instance");return r}var Xi=0;function Re(r){return"__private_"+Xi+++"_"+r}const Vi={version:"3.4.1"};function Ut(r,e){let t=e;return t||(t=new Error("Upload error")),typeof t=="string"&&(t=new Error(t)),t instanceof Error||(t=Object.assign(new Error("Upload error"),{data:t})),es(r)?(t=new ct(t,r),t):(t.request=r,t)}function At(r){return r.data.slice(0,r.data.size,r.meta.type)}var lt=Re("uploadLocalFile"),st=Re("uploadBundle"),dt=Re("getCompanionClientArgs"),rt=Re("uploadFiles"),_e=Re("handleUpload");class ts extends Gt{constructor(e,t){super(e,t),Object.defineProperty(this,rt,{value:Zi}),Object.defineProperty(this,dt,{value:Qi}),Object.defineProperty(this,st,{value:Yi}),Object.defineProperty(this,lt,{value:Ji}),Object.defineProperty(this,_e,{writable:!0,value:async i=>{if(i.length===0){this.uppy.log("[XHRUpload] No files to upload!");return}this.opts.limit===0&&!this.opts[tt]&&this.uppy.log("[XHRUpload] When uploading multiple files at once, consider setting the `limit` option (to `10` for example), to limit the number of concurrent uploads, which helps prevent memory and network issues: https://uppy.io/docs/xhr-upload/#limit-0","warning"),this.uppy.log("[XHRUpload] Uploading...");const o=this.uppy.getFilesByIds(i),a=Wi(o),n=Ki(a);if(this.uppy.emit("upload-start",n),this.opts.bundle){if(a.some(d=>d.isRemote))throw new Error("Can’t upload remote files when the `bundle: true` option is set");if(typeof this.opts.headers=="function")throw new TypeError("`headers` may not be a function when the `bundle: true` option is set");await fe(this,st)[st](a)}else await fe(this,rt)[rt](a)}}),this.type="uploader",this.id=this.opts.id||"XHRUpload",this.title="XHRUpload",this.defaultLocale=Gi;const s={formData:!0,fieldName:t.bundle?"files[]":"file",method:"post",allowedMetaFields:null,responseUrlFieldName:"url",bundle:!1,headers:{},timeout:30*1e3,limit:5,withCredentials:!1,responseType:"",getResponseData(i){let o={};try{o=JSON.parse(i)}catch(a){e.log(a)}return o},getResponseError(i,o){let a=new Error("Upload error");return es(o)&&(a=new ct(a,o)),a},validateStatus(i){return i>=200&&i<300}};if(this.opts={...s,...t},this.i18nInit(),tt in this.opts?this.requests=this.opts[tt]:this.requests=new qi(this.opts.limit),this.opts.bundle&&!this.opts.formData)throw new Error("`opts.formData` must be true when `opts.bundle` is enabled.");if((t==null?void 0:t.allowedMetaFields)===void 0&&"metaFields"in this.opts)throw new Error("The `metaFields` option has been renamed to `allowedMetaFields`.");this.uploaderEvents=Object.create(null)}getOptions(e){const t=this.uppy.getState().xhrUpload,{headers:s}=this.opts,i={...this.opts,...t||{},...e.xhrUpload||{},headers:{}};return typeof s=="function"?i.headers=s(e):Object.assign(i.headers,this.opts.headers),t&&Object.assign(i.headers,t.headers),e.xhrUpload&&Object.assign(i.headers,e.xhrUpload.headers),i}addMetadata(e,t,s){(Array.isArray(s.allowedMetaFields)?s.allowedMetaFields:Object.keys(t)).forEach(o=>{Array.isArray(t[o])?t[o].forEach(a=>e.append(o,a)):e.append(o,t[o])})}createFormDataUpload(e,t){const s=new FormData;this.addMetadata(s,e.meta,t);const i=At(e);return e.name?s.append(t.fieldName,i,e.meta.name):s.append(t.fieldName,i),s}createBundledUpload(e,t){const s=new FormData,{meta:i}=this.uppy.getState();return this.addMetadata(s,i,t),e.forEach(o=>{const a=this.getOptions(o),n=At(o);o.name?s.append(a.fieldName,n,o.name):s.append(a.fieldName,n)}),s}install(){if(this.opts.bundle){const{capabilities:e}=this.uppy.getState();this.uppy.setState({capabilities:{...e,individualCancellation:!1}})}this.uppy.addUploader(fe(this,_e)[_e])}uninstall(){if(this.opts.bundle){const{capabilities:e}=this.uppy.getState();this.uppy.setState({capabilities:{...e,individualCancellation:!0}})}this.uppy.removeUploader(fe(this,_e)[_e])}}async function Ji(r,e,t){const s=this.getOptions(r);return this.uppy.log(`uploading ${e} of ${t}`),new Promise((i,o)=>{const a=s.formData?this.createFormDataUpload(r,s):r.data,n=new XMLHttpRequest,l=new Vt(this.uppy);this.uploaderEvents[r.id]=l;let d;const u=new Zt(s.timeout,()=>{const h=new Error(this.i18n("uploadStalled",{seconds:Math.ceil(s.timeout/1e3)}));this.uppy.emit("upload-stalled",h,[r])}),c=kt();n.upload.addEventListener("loadstart",()=>{this.uppy.log(`[XHRUpload] ${c} started`)}),n.upload.addEventListener("progress",h=>{this.uppy.log(`[XHRUpload] ${c} progress: ${h.loaded} / ${h.total}`),u.progress(),h.lengthComputable&&this.uppy.emit("upload-progress",r,{uploader:this,bytesUploaded:h.loaded,bytesTotal:h.total})}),n.addEventListener("load",()=>{if(this.uppy.log(`[XHRUpload] ${c} finished`),u.done(),d.done(),this.uploaderEvents[r.id]&&(this.uploaderEvents[r.id].remove(),this.uploaderEvents[r.id]=null),s.validateStatus(n.status,n.responseText,n)){const z=s.getResponseData(n.responseText,n),Z=z[s.responseUrlFieldName],P={status:n.status,body:z,uploadURL:Z};return this.uppy.emit("upload-success",r,P),Z&&this.uppy.log(`Download ${r.name} from ${Z}`),i(r)}const h=s.getResponseData(n.responseText,n),m=Ut(n,s.getResponseError(n.responseText,n)),v={status:n.status,body:h};return this.uppy.emit("upload-error",r,m,v),o(m)}),n.addEventListener("error",()=>{this.uppy.log(`[XHRUpload] ${c} errored`),u.done(),d.done(),this.uploaderEvents[r.id]&&(this.uploaderEvents[r.id].remove(),this.uploaderEvents[r.id]=null);const h=Ut(n,s.getResponseError(n.responseText,n));return this.uppy.emit("upload-error",r,h),o(h)}),n.open(s.method.toUpperCase(),s.endpoint,!0),n.withCredentials=s.withCredentials,s.responseType!==""&&(n.responseType=s.responseType),d=this.requests.run(()=>{const h=this.getOptions(r);return Object.keys(h.headers).forEach(m=>{n.setRequestHeader(m,h.headers[m])}),n.send(a),()=>{u.done(),n.abort()}}),l.onFileRemove(r.id,()=>{d.abort(),o(new Error("File removed"))}),l.onCancelAll(r.id,h=>{let{reason:m}=h;m==="user"&&d.abort(),o(new Error("Upload cancelled"))})})}function Yi(r){return new Promise((e,t)=>{const{endpoint:s}=this.opts,{method:i}=this.opts,o=this.uppy.getState().xhrUpload,a=this.createBundledUpload(r,{...this.opts,...o||{}}),n=new XMLHttpRequest,l=u=>{r.forEach(c=>{this.uppy.emit("upload-error",c,u)})},d=new Zt(this.opts.timeout,()=>{const u=new Error(this.i18n("uploadStalled",{seconds:Math.ceil(this.opts.timeout/1e3)}));this.uppy.emit("upload-stalled",u,r)});n.upload.addEventListener("loadstart",()=>{this.uppy.log("[XHRUpload] started uploading bundle"),d.progress()}),n.upload.addEventListener("progress",u=>{d.progress(),u.lengthComputable&&r.forEach(c=>{this.uppy.emit("upload-progress",c,{uploader:this,bytesUploaded:u.loaded/u.total*c.size,bytesTotal:c.size})})}),n.addEventListener("load",u=>{if(d.done(),this.opts.validateStatus(u.target.status,n.responseText,n)){const h=this.opts.getResponseData(n.responseText,n),m={status:u.target.status,body:h};return r.forEach(v=>{this.uppy.emit("upload-success",v,m)}),e()}const c=this.opts.getResponseError(n.responseText,n)||new Error("Upload error");return c.request=n,l(c),t(c)}),n.addEventListener("error",()=>{d.done();const u=this.opts.getResponseError(n.responseText,n)||new Error("Upload error");return l(u),t(u)}),this.uppy.on("cancel-all",function(u){let{reason:c}=u===void 0?{}:u;c==="user"&&(d.done(),n.abort())}),n.open(i.toUpperCase(),s,!0),n.withCredentials=this.opts.withCredentials,this.opts.responseType!==""&&(n.responseType=this.opts.responseType),Object.keys(this.opts.headers).forEach(u=>{n.setRequestHeader(u,this.opts.headers[u])}),n.send(a)})}function Qi(r){const e=this.getOptions(r),t=Array.isArray(e.allowedMetaFields)?e.allowedMetaFields:Object.keys(r.meta);return{...r.remote.body,protocol:"multipart",endpoint:e.endpoint,size:r.data.size,fieldname:e.fieldName,metadata:Object.fromEntries(t.map(s=>[s,r.meta[s]])),httpMethod:e.method,useFormData:e.formData,headers:e.headers}}async function Zi(r){await Promise.allSettled(r.map((e,t)=>{const s=parseInt(t,10)+1,i=r.length;if(e.isRemote){const o=e.remote.providerOptions.provider?Ri:je,a=()=>this.requests,n=new o(this.uppy,e.remote.providerOptions,a),l=new AbortController,d=c=>{c.id===e.id&&l.abort()};this.uppy.on("file-removed",d);const u=n.uploadRemoteFile(e,fe(this,dt)[dt](e),{signal:l.signal});return this.requests.wrapSyncFunction(()=>{this.uppy.off("file-removed",d)},{priority:-1})(),u}return fe(this,lt)[lt](e,s,i)}))}ts.VERSION=Vi.version;function ss(r,e,t,s){let{onSuccess:i}=s;r.readEntries(o=>{const a=[...e,...o];o.length?queueMicrotask(()=>{ss(r,a,t,{onSuccess:i})}):i(a)},o=>{t(o),i(e)})}function rs(r,e){return r==null?r:{kind:r.isFile?"file":r.isDirectory?"directory":void 0,name:r.name,getFile(){return new Promise((t,s)=>r.file(t,s))},async*values(){const t=r.createReader();yield*await new Promise(i=>{ss(t,[],e,{onSuccess:o=>i(o.map(a=>rs(a,e)))})})}}}function is(r,e,t){try{return t===void 0&&(t=void 0),async function*(){const s=()=>`${e}/${r.name}`;if(r.kind==="file"){const i=await r.getFile();i!=null?(i.relativePath=e?s():null,yield i):t!=null&&(yield t)}else if(r.kind==="directory")for await(const i of r.values())yield*is(i,e?s():r.name);else t!=null&&(yield t)}()}catch(s){return Promise.reject(s)}}async function*eo(r,e){const t=await Promise.all(Array.from(r.items,async s=>{var i;let o;const a=()=>typeof s.getAsEntry=="function"?s.getAsEntry():s.webkitGetAsEntry();return(i=o)!=null||(o=rs(a(),e)),{fileSystemHandle:o,lastResortFile:s.getAsFile()}}));for(const{lastResortFile:s,fileSystemHandle:i}of t)if(i!=null)try{yield*is(i,"",s)}catch(o){s!=null?yield s:e(o)}else s!=null&&(yield s)}const os=Array.from;function to(r){const e=os(r.files);return Promise.resolve(e)}async function so(r,e){let{logDropError:t=()=>{}}=e===void 0?{}:e;try{const s=[];for await(const i of eo(r,t))s.push(i);return s}catch{return to(r)}}const ro={version:"2.0.1"};function it(r){var e,t;return(e=(t=r.dataTransfer.types)==null?void 0:t.some(s=>s==="Files"))!=null?e:!1}class ns extends Gt{constructor(e,t){super(e,t),this.addFiles=i=>{const o=i.map(a=>({source:this.id,name:a.name,type:a.type,data:a,meta:{relativePath:a.relativePath||null}}));try{this.uppy.addFiles(o)}catch(a){this.uppy.log(a)}},this.handleDrop=async i=>{var o,a;if(!it(i))return;i.preventDefault(),i.stopPropagation(),clearTimeout(this.removeDragOverClassTimeout),i.currentTarget.classList.remove("uppy-is-drag-over"),this.setPluginState({isDraggingOver:!1}),this.uppy.iteratePlugins(u=>{u.type==="acquirer"&&(u.handleRootDrop==null||u.handleRootDrop(i))});let n=!1;const l=u=>{this.uppy.log(u,"error"),n||(this.uppy.info(u.message,"error"),n=!0)},d=await so(i.dataTransfer,{logDropError:l});d.length>0&&(this.uppy.log("[DropTarget] Files were dropped"),this.addFiles(d)),(o=(a=this.opts).onDrop)==null||o.call(a,i)},this.handleDragOver=i=>{var o,a;it(i)&&(i.preventDefault(),i.stopPropagation(),i.dataTransfer.dropEffect="copy",clearTimeout(this.removeDragOverClassTimeout),i.currentTarget.classList.add("uppy-is-drag-over"),this.setPluginState({isDraggingOver:!0}),(o=(a=this.opts).onDragOver)==null||o.call(a,i))},this.handleDragLeave=i=>{var o,a;if(!it(i))return;i.preventDefault(),i.stopPropagation();const{currentTarget:n}=i;clearTimeout(this.removeDragOverClassTimeout),this.removeDragOverClassTimeout=setTimeout(()=>{n.classList.remove("uppy-is-drag-over"),this.setPluginState({isDraggingOver:!1})},50),(o=(a=this.opts).onDragLeave)==null||o.call(a,i)},this.addListeners=()=>{const{target:i}=this.opts;if(i instanceof Element?this.nodes=[i]:typeof i=="string"&&(this.nodes=os(document.querySelectorAll(i))),!this.nodes&&!this.nodes.length>0)throw new Error(`"${i}" does not match any HTML elements`);this.nodes.forEach(o=>{o.addEventListener("dragover",this.handleDragOver,!1),o.addEventListener("dragleave",this.handleDragLeave,!1),o.addEventListener("drop",this.handleDrop,!1)})},this.removeListeners=()=>{this.nodes&&this.nodes.forEach(i=>{i.removeEventListener("dragover",this.handleDragOver,!1),i.removeEventListener("dragleave",this.handleDragLeave,!1),i.removeEventListener("drop",this.handleDrop,!1)})},this.type="acquirer",this.id=this.opts.id||"DropTarget",this.title="Drop Target";const s={target:null};this.opts={...s,...t},this.removeDragOverClassTimeout=null}install(){this.setPluginState({isDraggingOver:!1}),this.addListeners()}uninstall(){this.removeListeners()}}ns.VERSION=ro.version;const io={class:"example-one w-full"},oo={key:0,class:"flex flex-wrap justify-around"},no={key:1,class:"p-28 h-full align-middle"},ao=U("p",null,"Tranmission ...",-1),lo=["value"],uo=U("div",{class:"for-DragDrop"},null,-1),co=U("div",{class:"for-ProgressBar"},null,-1),po=U("div",{class:"uploaded-files"},[U("h5",null,"Uploaded files:"),U("ol")],-1),yo=ps({__name:"main2",props:{uploadUrl:{},sessionPath:{},showFiles:{type:Boolean,default:!0}},emits:["uploadSuccess","uploadError","uploadStart"],async setup(r,{expose:e,emit:t}){let s,i;const o=r,a=us(),{backend:n,useFetchPP:l,getToken:d}=cs(),u=([s,i]=hs(()=>d()),s=await s,i(),s),c=ft(0),h=ft(!1),m=fs([]),v=async(g,b)=>{var T;c.value=100,h.value=!1,(o.showFiles==!1||((T=b==null?void 0:b.body)==null?void 0:T.stored)==!1)&&P.removeFile(g.id),o.showFiles&&await ee(),t("uploadSuccess",b.body)},z=(g,b,T)=>{c.value=100,h.value=!1,t("uploadError",T)};function Z(g){c.value=g/2}var P=new Kt({id:"uppy1",autoProceed:!0,debug:!1,locale:{strings:{cancel:"Annuler"}},onBeforeUpload:g=>{const b={};return Object.keys(g).forEach(T=>{g[T].meta.from_pp_session!==!0&&(b[T]={...g[T]})}),b},onBeforeFileAdded:(g,b)=>(h.value=!0,t("uploadStart"),g)});async function ke(){P.on("upload-success",v).on("upload-error",z).on("progress",Z).use(ts,{endpoint:`${n}${o.uploadUrl}`,headers:{Authorization:`Bearer ${u}`}}).use(ns,{target:document.body}),o.showFiles&&await ee()}ms(async()=>{await ke()});async function ee(){try{const{data:b}=await l(`/api/files/session/${o.sessionPath}`);m.splice(0);for(const T of b.value)m.push({url:T.name})}catch{a.error("Erreur lors de la récupération du contenu de la session")}const g={...P.getState().files};P.setState({files:g})}async function Le(){await l(`/api/files/session/${o.sessionPath}`,{method:"DELETE",toast:{success:{msg:"Fichiers supprimés !"},error:{msg:"Erreur lors de la ré-initialisation de la session"}}}),P.getFiles().map(function(g){P.removeFile(g.id)}),await ee()}async function me(g){await l(`/api/files/session/${o.sessionPath}/${g.url}`,{method:"DELETE",toast:{success:{msg:`Fichier ${g.url} supprimé !`},error:{msg:`Erreur lors de la suppresion de ${g.url}`}}}),P.getFiles().map(function(b){P.removeFile(b.id)}),await ee()}gs(()=>{P.close({reason:"unmount"})});function w(g){Array.from(g.target.files).forEach(T=>{h.value=!0;try{P.addFile({source:"file input",name:T.name,type:T.type,data:T})}catch(ge){ge.isRestriction?console.log("Restriction error:",ge):console.error(ge)}})}function I(){console.log("open_file ..."),document.getElementById("my-file-input").click()}return e({reset:Le,refresh:ee}),(g,b)=>{const T=ls,ge=ds;return Ne(),Me("section",io,[U("div",null,[he(h)?He("",!0):(Ne(),Me("div",{key:0,onClick:I},[vs(g.$slots,"default")])),ys(U("input",{onChange:w,id:"my-file-input",type:"file",placeholder:"Type here"},null,544),[[ws,!1]])]),g.showFiles?(Ne(),Me("div",oo,[mt(T,{pdfs:he(m),download_on_click:!1,action1_enabled:"",action1_icon:"ic:baseline-delete-forever",onAction1:me},null,8,["pdfs"])])):He("",!0),he(h)?(Ne(),Me("div",no,[ao,U("progress",{class:"progress progress-info w-56",value:he(c),max:"100"},null,8,lo)])):He("",!0),uo,co,mt(ge,{title:"components/dropfile/main2"},{default:bs(()=>[U("p",null,"progressShow = "+gt(he(h)),1),U("p",null,"progressGlobal = "+gt(he(c)),1),po,U("button",{class:"btn btn-primary m-3",onClick:ee},"Actualiser"),U("button",{class:"btn btn-primary m-3",onClick:Le},"Remise à zéro"),U("button",{class:"btn btn-primary m-3",onClick:b[0]||(b[0]=(...as)=>g.upload&&g.upload(...as))},"Envoyer")]),_:1})])}}});export{yo as _};
